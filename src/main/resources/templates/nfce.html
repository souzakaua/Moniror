<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/nf.css}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="icon" type="image/x-icon" href="/img/iconA.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <title>Monitor de Serviços NF</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>

<body>
    <div class="headerMenu">
        <img class="logo" src="/img/atacadao.png" alt="logoatacadao" />
        <p>EMISSÃO NFCE</p>
        <img class="menuIcon" src="/img/menu.png" alt="" />
    </div>

    <div class="upBox">
        <div class="box box1"><br>
            <p class="tituloBox">Diario</p>
            <div class="valorBox">
                <p th:text="${totalNotasDiaAtual}"></p>

                <span><i class="fa-solid fa-calendar-day"></i></span>
            </div>
            <p th:if="${totalNF1} > ${totalNF2}" th:text="' ↑ '+${#numbers.formatDecimal(dif, 1, 3)}" class="subValor positivo"></p>
            <p th:if="${totalNF1} < ${totalNF2}" th:text="' ↓ '+${#numbers.formatDecimal(dif, 1, 3)}" class="subValor negativo"></p>
            <p th:if="${totalNF1} == ${totalNF2}" th:text="' - '+${#numbers.formatDecimal(dif, 1, 3)}" class="subValor neutro"></p>
        </div>

        <div class="box box2"><br>
            <p class="tituloBox">Quantidade de Documentos</p>
            <div class="valorBox">
                <p th:text="${documentos1}"></p>
                <span><i class="fa-solid fa-clock"></i></span>
            </div>
            <p th:if="${documentos1} > ${documentos2}" th:text="' ↑ '+${difDoc}" class="subValor positivo"></p>
            <p th:if="${documentos1} < ${documentos2}" th:text="' ↓ '+${difDoc}" class="subValor negativo"></p>
            <p th:if="${documentos1} == ${documentos2}" th:text="' - '+${difDoc}" class="subValor neutro"></p>
        </div>

        <div class="box box3"><br>
            <p class="tituloBox">Tempo Medio</p>
            <div class="valorBox">
                <p th:text="${media1}"></p>
                <span><i class="fa-solid fa-clock-rotate-left"></i></i></span>
            </div>
            <p style="color: red;" th:if="${media1} > ${media2}" th:text="' ↑ '+${difMedia}" class="subValor positivo"></p>
            <p style="color: rgb(67, 211, 67);" th:if="${media1} < ${media2}" th:text="' ↓ '+${difMedia}" class="subValor negativo"></p>
            <p th:if="${media1} == ${media2}" th:text="' - '+${difMedia}" class="subValor neutro" ></p>
        </div>

        <div class="box box4"><br>
            <p class="tituloBox">Emissão por hora</p>
            <div class="valorBox">
                <p th:text="${emissao1}"></p>
                <span><i class="fa-solid fa-print"></i></span>
            </div>
            <p th:if="${emissao1} > ${emissao2}" th:text="' ↑ '+${difEmissao}" class="subValor positivo"></p>
            <p th:if="${emissao1} < ${emissao2}" th:text="' ↓ '+${difEmissao}" class="subValor negativo"></p>
            <p th:if="${emissao1} == ${emissao2}" th:text="' - '+${difEmissao}" class="subValor neutro" ></p>
        </div>
    </div>

    <div class="graficos">
        <div id="main"></div>

        <div id="grafico2"></div>

        <div id="grafico3"></div>

        <div id="grafico4"></div>

        <section class="tabelaEmissao">
            <div class="headerTable">
                <div class="tituloTable">
                    <h3>Emissão Geral</h3>
                    <p>Acompanhamento detalhado de emissão</p>
                </div>
                <div class="pesquisa">
                    <span><i class="fa-solid fa-magnifying-glass"></i></span>
                    <input class="pesquisaTableInput" type="text" value="">
                </div>
            </div>
            <table cellspacing="0">
                <thead>
                    <tr>
                        <th class="colunaTabela1" scope="col">Data</th>
                        <th class="colunaTabela1" scope="col">Hora</th>
                        <th class="colunaTabela1" scope="col">Total NF</th>
                        <th class="colunaTabela1" scope="col">Media</th>
                        <th class="colunaTabela1" scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="tr1" th:each="l : ${linhas}">
                        <th class="linhaTabela1" th:text="${l['data']}" scope="row"></th>
                        <th class="linhaTabela1" th:text="${l['hora']}" scope="row"></th>
                        <th class="linhaTabela1" th:text="${l['total']}" scope="row"></th>
                        <th class="linhaTabela1" th:text="${l['media']}" scope="row"></th>
                        <th class="linhaTabela1 iconInfo" scope="row"><i class="fa-solid fa-circle-info"></i></th>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="tabela2">
            <h3>Filiais sem emissão</h3>
            <div class="dadosTabela">
                <table cellspacing="0">
                    <thead>
                        <tr>
                            <th class="colunaTabela2" scope="col">Data</th>
                            <th class="colunaTabela2" scope="col">Hora</th>
                            <th class="colunaTabela2" scope="col">N°</th>
                            <th class="colunaTabela2" scope="col">Filial</th>
                            <th class="colunaTabela2" scope="col">Média</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>
                        <tr>
                            <th class="linhaTabela2" scope="row">06/05/2025</th>
                            <th class="linhaTabela2" scope="row">15:30</th>
                            <th class="linhaTabela2" scope="row">340</th>
                            <th class="linhaTabela2" scope="row">Tatuape</th>
                            <th class="linhaTabela2" scope="row">09</th>
                        </tr>

                    </tbody>
                </table>

                <div id="grafico5"></div>
            </div>
        </section>
    </div><br><br><br>

    <!--GRAFICO 1-->
    <script th:inline="javascript">
        // Funções de interpolação
        function getGradientColor(value) {
            const max = 100;
            if (value <= 70) {
                const ratio = value / 70;
                return interpolateColor('#7CFFB2', '#FFD700', ratio);
            }
            const ratio = (value - 70) / 30;
            return interpolateColor('#FFD700', '#c23677', ratio);
        }

        function interpolateColor(color1, color2, factor) {
            const c1 = hexToRgb(color1);
            const c2 = hexToRgb(color2);
            const r = Math.round(c1.r + (c2.r - c1.r) * factor);
            const g = Math.round(c1.g + (c2.g - c1.g) * factor);
            const b = Math.round(c1.b + (c2.b - c1.b) * factor);
            return `rgb(${r}, ${g}, ${b})`;
        }

        function hexToRgb(hex) {
            const bigint = parseInt(hex.slice(1), 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        // Valor e gráfico
        const valor = [[${media1}]];
        const max = 100;
        const corDinamica = getGradientColor(valor);


        const myChart = echarts.init(document.getElementById('main'));

        const option = {
            backgroundColor: '#232631',
            title: {
                text: 'Tempo Médio',
                left: '10',
                top: '10',
                textStyle: {
                    fontSize: 16,
                    fontWeight: 'bold',
                    color: 'white'
                }
            },
            tooltip: {},
            series: [
                {
                    type: 'gauge',
                    startAngle: 180,
                    endAngle: 0,
                    center: ['50%', '75%'],
                    radius: '100%',
                    min: 0,
                    max: max,
                    axisLine: {
                        lineStyle: {
                            width: 45,
                            color: [ [valor / max, corDinamica], [1, '#e6e9ee'] ]
                        }
                    },
                    pointer: { show: false },
                    axisTick: { show: false },
                    splitLine: { show: false },
                    axisLabel: { show: false },
                    title: {
                        offsetCenter: [0, '-20%'],
                        fontSize: 14,
                        color: 'white',
                        fontWeight: 'normal',
                        text: 'Tempo Médio (NPS)'
                    },
                    detail: {
                        fontSize: 28,
                        offsetCenter: [0, '-5%'],
                        valueAnimation: true,
                        formatter: '{value}',
                        color: 'white'
                    },
                    data: [
                        {
                            value: valor,
                            name: 'Tempo Médio'
                        }
                    ]
                }
            ]
        };

        myChart.setOption(option);
    </script>
    <!--GRAFICO 2-->
    <script>
        $(document).ready(function () {
            $.get('/api/grafico-tempo', function (dados) {
                const horas = dados.map(p => p.hora).reverse();
                const medias = dados.map(p => p.media).reverse();

                var chartDom = document.getElementById('grafico2');
                var myChart3 = echarts.init(chartDom);
                var option3 = {
                    backgroundColor: '#232631',
                    title: {
                        text: 'Tempo Médio',
                        padding: 20,
                        left: 'left',
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'bold',
                            color: 'white'
                        },
                    },
                    tooltip: {},
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: horas
                    },
                    yAxis: {
                        type: 'value',
                        max: function (value){
                        return value.max < 100 ? 70 : value.max;
                        }
                    },
                    series: [
                        {
                            data: medias,
                            type: 'line',
                            areaStyle: {
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                    { offset: 0, color: 'rgba(0, 126, 90, 1)' },
                                    { offset: 1, color: 'rgb(70, 161, 128)' }
                                ])
                            }
                        }
                    ]
                };

                myChart3.setOption(option3);
            });
        });
    </script>


    <!--GRAFICO 3-->
    <script>
        var chartDom = document.getElementById('grafico3');
        var myChart2 = echarts.init(chartDom, 'dark');
        var option2 = {
            backgroundColor: '#232631',
            title: {
                text: 'Tempo de Emissão - Regionais',
                padding: 20,
                left: 'left',
                textStyle: {
                    fontSize: 16,
                    fontWeight: 'bold',
                    color: 'white'
                },
            },
            tooltip: {},
            xAxis: {
                type: 'category',
                data: ['SP-C', 'SP-I', 'MS', 'DF/GO', 'PR', 'BA/SE', 'NO', 'MT', 'PE', 'MG', 'RJ/ES', 'CE', 'RS', 'SC',],
                axisLine: { lineStyle: { color: '#aaa' } },
                axisLabel: { color: '#ccc' }
            },
            yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#aaa' } },
                axisLabel: { color: '#ccc' },
                splitLine: { lineStyle: { color: '#333' } }
            },
            series: [
                {
                    data: [120, 200, 150, 80, 70, 90, 180, 150, 30, 20, 90, 110, 130, 160],
                    type: 'bar',
                    barWidth: 45,
                    showBackground: true,
                    backgroundStyle: {
                        color: 'rgba(255, 255, 255, 0.05)'
                    },
                    itemStyle: {
                        borderRadius: [10, 10, 0, 0],
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(0, 126, 90, 1)' },
                            { offset: 1, color: 'rgb(70, 161, 128)' }
                        ])
                    }
                }
            ]
        };


        option2 && myChart2.setOption(option2);
    </script>

    <!--GRAFICO 4-->
    <script type="text/javascript">
        var myChart4 = echarts.init(document.getElementById('grafico4'));
        myChart4.showLoading();

        $.get('/echart-geojsonbr.json', function (brazilJson) {
            myChart4.hideLoading();
            echarts.registerMap('Brazil', brazilJson);

            var option = {
                backgroundColor: '#232631',
                title: {
                    text: 'Tempo de Emissão - Brasil',
                    subtext: 'NFCE',
                    padding: 20,
                    left: 'left',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold',
                        color: 'white'
                    },
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        return params.name + '<br/>Tempo médio: ' + (params.value ? params.value + 's' : 'Normal');
                    }
                },
                toolbox: {
                    show: true,
                    left: 'right',
                    top: 'top',
                    feature: {
                        dataView: { readOnly: false },
                        restore: {},
                        saveAsImage: {}
                    }
                },
                series: [
                    {
                        name: 'Tempo de Emissão',
                        type: 'map',
                        map: 'Brazil',
                        roam: true,
                        itemStyle: {
                            areaColor: '#3a3f4b', // Cor base
                            borderColor: '#999',
                            borderWidth: 0.5
                        },
                        emphasis: {
                            label: {
                                show: true,
                                color: 'white'
                            },
                            itemStyle: {
                                borderColor: '#fff',
                                borderWidth: 1
                            }
                        },
                        data: [
                            { name: 'Acre', value: null },
                            { name: 'Alagoas', value: null },
                            { name: 'Amapá', value: null },
                            {
                                name: 'Amazonas',
                                value: 12,
                                itemStyle: { areaColor: 'red' }
                            },
                            {
                                name: 'Bahia',
                                value: 15,
                                itemStyle: { areaColor: 'red' }
                            },
                            { name: 'Ceará', value: null },
                            { name: 'Distrito Federal', value: null },
                            {
                                name: 'Espírito Santo',
                                value: 11,
                                itemStyle: { areaColor: 'red' }
                            },
                            { name: 'Goiás', value: null },
                            { name: 'Maranhão', value: null },
                            { name: 'Mato Grosso', value: null },
                            { name: 'Mato Grosso do Sul', value: null },
                            { name: 'Minas Gerais', value: null },
                            { name: 'Pará', value: null },
                            { name: 'Paraíba', value: null },
                            {
                                name: 'Paraná',
                                value: 13,
                                itemStyle: { areaColor: 'red' }
                            },
                            { name: 'Pernambuco', value: null },
                            { name: 'Piauí', value: null },
                            {
                                name: 'Rio de Janeiro',
                                value: 14,
                                itemStyle: { areaColor: 'red' }
                            },
                            { name: 'Rio Grande do Norte', value: null },
                            { name: 'Rio Grande do Sul', value: null },
                            { name: 'Rondônia', value: null },
                            { name: 'Roraima', value: null },
                            { name: 'Santa Catarina', value: null },
                            { name: 'São Paulo', value: null },
                            { name: 'Sergipe', value: null },
                            { name: 'Tocantins', value: null }
                        ]
                    }
                ]
            };

            myChart4.setOption(option);
        });
    </script>

    <!--GRAFICO 5-->
    <script>
        var chartDom = document.getElementById('grafico5');
        var myChart5 = echarts.init(chartDom);
        var option5;

        option5 = {
            backgroundColor: '#232631',
            tooltip: {
                trigger: 'item'
            },
            legend: {
                top: '5%',
                left: 'center',
                textStyle: {
                    color: 'white',
                },
            },
            series: [
                {
                    name: 'Access From',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: false,
                    padAngle: 5,
                    itemStyle: {
                        borderRadius: 10
                    },
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 40,
                            fontWeight: 'bold'
                        }
                    },
                    labelLine: {
                        show: false
                    },
                    data: [
                        { value: 2000, name: '+20min', itemStyle: { color: '#FF6B6B' } },
                        { value: 500, name: '10min', itemStyle: { color: '#FFD93D' } },
                        { value: 890, name: '5Min', itemStyle: { color: 'rgba(0, 126, 90, 1)' } },
                    ]
                }
            ]
        };

        option5 && myChart5.setOption(option5);
    </script>

</body>

</html>